<div class="cont">
    <div class="head">
        Manage
        <div class="action">
            <img src="../asset/images/icon/show.png" alt="show" onclick="show()" />
            <img src="../asset/images/icon/add.png" alt="add" onclick="add()" />
            <img src="../asset/images/icon/edit.png" alt="edit" onclick="edit()" />
            <img src="../asset/images/icon/delete.png" alt="delete" onclick="delet()" />
        </div>
    </div>
    <div class="body">
        <table cellspacing="0"></table>
    </div>
</div>
<script>
    let show = () => {
        let tmp = gElement(".body");
        tmp.innerHTML = "";
        let table = createUI({
            content: "table"
        });
        tmp.child(table);
        let r = createUI({
            content: "tr"
        });
        let hk = createUI({
            content: "th",
            val: "kode"
        });
        let hj = createUI({
            content: "th",
            val: "judul"
        });
        let hs = createUI({
            content: "th",
            val: "stok"
        });
        r.child(hk);
        r.child(hj);
        r.child(hs);
        table.child(r);

        get("../api/buku.php?list", e => {
            e.forEach(list => {
                let row = createUI({
                    content: "tr"
                });
                let kode = createUI({
                    content: "td",
                    val: list.kode
                });
                let judul = createUI({
                    content: "td",
                    val: list.judul
                });
                let kategori = createUI({
                    content: "td",
                    val: list.kategori
                });
                row.child(kode);
                row.child(judul);
                row.child(kategori);
                table.child(row);
            });
        });
    };
    let add = () => {
        let tmp = gElement(".body");
        tmp.innerHTML = "";
        let wrp = createUI({
            content: "div",
            class: "wrapper-body"
        });
        let judul = createUI({
            content: "input",
            placeholder: "Judul Buku",
            id: "judul",
            value: ""
        });
        let kategori = createUI({
            content: "select",
            id: "kategori"
        });
        let penerbit = createUI({
            content: "select",
            id: "penerbit"
        });
        let penulis = createUI({
            content: "select",
            id: "penulis"
        });
        let stok = createUI({
            content: "input",
            id: "stok",
            value: "0",
            type: "number",
            style: "width:25%;margin-left:-55%"
        });
        kategori.child(
            createUI({
                content: "option",
                value: "x",
                val: "--pilih kategori--"
            })
        );
        penerbit.child(
            createUI({
                content: "option",
                value: "x",
                val: "--pilih penerbit--"
            })
        );
        penulis.child(
            createUI({
                content: "option",
                value: "x",
                val: "--pilih penulis--"
            })
        );
        get("../api/buku.php?shu", e => {
            e.forEach(f => {
                let option;

                option = createUI({
                    content: "option",
                    value: f.id,
                    val: f.nama
                });
                penerbit.child(option);
            });
        });
        get("../api/buku.php?sakka", e => {
            e.forEach(f => {
                let option;

                option = createUI({
                    content: "option",
                    value: f.id,
                    val: f.nama
                });

                penulis.child(option);
            });
        });
        get("../api/buku.php?cat", e => {
            e.forEach(f => {
                let option;

                option = createUI({
                    content: "option",
                    value: f.id,
                    val: f.nama
                });

                kategori.child(option);
            });
        });
        wrp.child(judul);
        wrp.child(kategori);
        wrp.child(penerbit);
        wrp.child(penulis);
        wrp.child(stok);
        tmp.child(wrp);
        wrp.child(
            createUI({
                content: "button",
                id: "btnedit",
                val: "Tambah",
                style: "margin-top:5%",
                onclick: "tambah()"
            })
        );
    };
    let edit = () => {
        let tmp = gElement(".body");
        tmp.innerHTML = "";
        let wrapper = createUI({
            content: "div",
            class: "wrapper-sub"
        });
        let idi = createUI({
            content: "input",
            placeholder: "kode buku",
            id: "kode"
        });
        let btncek = createUI({
            content: "button",
            val: "Lanjut",
            onclick: "cek()"
        });
        wrapper.child(idi);
        wrapper.child(btncek);
        tmp.child(wrapper);
    };
    show();
    // add();
    let temp;
    let cek = () => {
        let tmp = gElement(".body");

        let judul = gElement("#kode");
        get("../api/buku.php?cek=" + judul.value, e => {
            let v = e[0];
            !temp ? (temp = tmp.innerHTML) : (tmp.innerHTML = temp);
            console.log(e);
            if (e == "null") {
                alert("buku tidak ditemukan!");
            } else {
                let wrp = createUI({
                    content: "div",
                    class: "wrapper-body"
                });
                let judul = createUI({
                    content: "input",
                    placeholder: "Judul",
                    id: "judul",
                    value: v.judul
                });
                let kategori = createUI({
                    content: "select",
                    id: "kategori"
                });
                let penerbit = createUI({
                    content: "select",
                    id: "penerbit"
                });
                let penulis = createUI({
                    content: "select",
                    id: "penulis"
                });
                let stok = createUI({
                    content: "input",
                    id: "stok",
                    value: v.stok,
                    type: "number",
                    style: "width:25%;margin-left:-55%"
                });
                kategori.child(
                    createUI({
                        content: "option",
                        value: "x",
                        val: "--pilih kategori--"
                    })
                );
                penerbit.child(
                    createUI({
                        content: "option",
                        value: "x",
                        val: "--pilih penerbit--"
                    })
                );
                penulis.child(
                    createUI({
                        content: "option",
                        value: "x",
                        val: "--pilih penulis--"
                    })
                );
                get("../api/buku.php?shu", e => {
                    e.forEach(f => {
                        let option;
                        if (v.penerbit == f.id) {
                            option = createUI({
                                content: "option",
                                value: f.id,
                                val: f.nama,
                                selected: "selected"
                            });
                        } else {
                            option = createUI({
                                content: "option",
                                value: f.id,
                                val: f.nama
                            });
                        }

                        penerbit.child(option);
                    });
                });
                get("../api/buku.php?sakka", e => {
                    e.forEach(f => {
                        let option;
                        if (v.penulis == f.id) {
                            option = createUI({
                                content: "option",
                                value: f.id,
                                val: f.nama,
                                selected: "selected"
                            });
                        } else {
                            option = createUI({
                                content: "option",
                                value: f.id,
                                val: f.nama
                            });
                        }
                        penulis.child(option);
                    });
                });
                get("../api/buku.php?cat", e => {
                    e.forEach(f => {
                        let option;
                        if (v.kategori == f.id) {
                            option = createUI({
                                content: "option",
                                value: f.id,
                                val: f.nama,
                                selected: "selected"
                            });
                        } else {
                            option = createUI({
                                content: "option",
                                value: f.id,
                                val: f.nama
                            });
                        }
                        kategori.child(option);
                    });
                });
                wrp.child(judul);
                wrp.child(kategori);
                wrp.child(penerbit);
                wrp.child(penulis);
                wrp.child(stok);
                tmp.child(wrp);
                wrp.child(
                    createUI({
                        content: "button",
                        id: "btnedit",
                        val: "Edit",
                        style: "margin-top:5%",
                        onclick: "submit()"
                    })
                );
            }
        });
    };
    let submit = () => {
        let kat = gElement("#kategori");
        let shu = gElement("#penerbit");
        let sakka = gElement("#penulis");
        let stok = gElement("#stok");
        if (
            kat.value == "x" ||
            shu.value == "x" ||
            sakka.value == "x" ||
            stok.value < 0
        ) {
            alert("tolong isi semua kolom!");
        } else {
            let data = {
                kode: gElement("#kode").value,
                kategori: gElement("#kategori").selectedIndex,
                judul: gElement("#judul").value,
                penulis: gElement("#penulis").selectedIndex,
                penerbit: gElement("#penerbit").selectedIndex,
                stok: gElement("#stok").value,
                status: "edit"
            };
            post(
                "../api/buku.php", {
                    data: data
                },
                e => {
                    console.log(e);
                }
            );
        }
    };
    let tambah = () => {
        let kat = gElement("#kategori");
        let shu = gElement("#penerbit");
        let sakka = gElement("#penulis");
        let stok = gElement("#stok");
        if (
            kat.value == "x" ||
            shu.value == "x" ||
            sakka.value == "x" ||
            stok.value < 0
        ) {
            alert("tolong isi semua kolom!");
        }
        else{
            let data = {
            kategori: gElement("#kategori").selectedIndex,
            judul: gElement("#judul").value,
            penulis: gElement("#penulis").selectedIndex,
            penerbit: gElement("#penerbit").selectedIndex,
            stok: gElement("#stok").value,
            status: "add"
        };

        post(
            "../api/buku.php", {
                data: data
            },
            e => {
                console.log(e);
            }
        ); 
        }
        
    };
</script>